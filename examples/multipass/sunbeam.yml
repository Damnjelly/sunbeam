name: multipass
title: Multipass
version: "1.0"
rootItems:
  - script: manageVMs
    title: Manage VMs
scripts:
  manageVMs:
    command: |
      multipass list --format json | sunbeam query '.list[] |
      {
        title: .name,
        subtitle: .state,
        accessories: [
          .release,
          .ipv4[0]
        ],
        actions:
          (
            if
              .state == "Running"
            then
              [
                {type: "execCommand", title: "Stop", reloadPage: true, command: "multipass stop \(.name)"},
                {type: "execCommand", title: "Open Shell", shortcut: "ctrl+l", command: "multipass shell \(.name)"}
              ]
            else
              [
                {type: "execCommand", title: "Start", reloadPage: true, command: "multipass start \(.name)"}
              ]
            end
          ),
      }
      '
    output: page
    page:
      type: list
      mode: filter
