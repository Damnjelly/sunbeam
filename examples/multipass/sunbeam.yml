name: multipass
title: Multipass
version: "1.0"
rootItems:
  - script: manageVMs
    title: Manage VMs
scripts:
  manageVMs:
    command: |
      multipass list --format json | sunbeam query '.list[] |
      {
        title: .name,
        accessories: [
          .state
        ],
        previewCmd: "multipass info \(.name)",
        actions:
          (
            if
              .state == "Running"
            then
              [
                {type: "execCommand", title: "Stop", reloadPage: true, command: "multipass stop \(.name)"},
                {type: "execCommand", title: "Open Shell", shortcut: "ctrl+l", command: "multipass shell \(.name)"}
              ]
            else
              [
                {type: "execCommand", title: "Start", reloadPage: true, command: "multipass start \(.name)"}
              ]
            end + [
              {type: "runScript", title: "Describe VM", script: "describeVM", with: {name: .name}}
            ]
          ),
      }
      '
    output: page
    page:
      type: list
      mode: filter
      showPreview: true
