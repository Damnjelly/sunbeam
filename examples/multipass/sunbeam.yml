name: multipass
title: Multipass
version: "1.0"
requirements:
  - homePage: https://multipass.run
    which: multipass
rootItems:
  - script: manageVMs
    title: Manage VMs
scripts:
  manageVMs:
    command: |
      multipass list --format json | sunbeam query '.list[] |
      {
        title: .name,
        accessories: [
          .state
        ],
        previewCmd: "multipass info \(.name)",
        actions:
          (
            if
              .state == "Running"
            then
              [
                {type: "execCommand", title: "Stop \(.name)", onSuccess: "reloadPage", command: "multipass stop \(.name)"},
                {type: "execCommand", title: "Open Shell", shortcut: "ctrl+s", command: "multipass shell \(.name)"}
              ]
            else
              [
                {type: "execCommand", title: "Start \(.name)", onSuccess: "reloadPage", command: "multipass start \(.name)"}
              ]
            end
          ),
      }
      '
    output: page
    page:
      type: list
      mode: filter
      showPreview: true
